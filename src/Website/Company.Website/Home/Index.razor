@page "/"

@inject AdoptionService _adoptionService

<div class="content px-4">
    <h1><b>Adopt</b> a RockPal</h1>
    <div class="card-deck">
        @if (_adoptableRocks != null)
        {
            @foreach (var petRock in _adoptableRocks)
            {
                <AdoptableRockCard AdoptableRock="@petRock"></AdoptableRockCard>
            }
        }
    </div>

    <h1 class="look-after-header"><b>Look After</b> your RockPal's</h1>

    <AuthorizeView>
        <Authorized>
            @if (_petRocks != null)
            {
                <div class="card-deck">
                    @foreach (var petRock in _petRocks)
                    {
                        <div class="card img-fluid rockpal-card">
                            <h1 class="card-title">@petRock.Name</h1>
                            <img class="card-img" src="@petRock.Images.First()" alt="Card image">
                            @foreach (var attr in petRock.Attributes)
                            {
                                <h6>
                                    <b>@attr.Key:</b> @attr.Value
                                </h6>
                            }
                        </div>
                    }
                </div>
            }
            else
            {
                <h4>Once you've adopted a RockPal, you'll see them here.</h4>
            }
        </Authorized>
        <NotAuthorized>
            <h4>Log in to look after your RockPal's.</h4>
        </NotAuthorized>
    </AuthorizeView>
</div>

@code {
    [CascadingParameter] private Task<AuthenticationState> authStateTask { get; set; }

    private List<PetRock> _petRocks;
    private List<AdoptableRock> _adoptableRocks;

    protected override async Task OnInitializedAsync()
    {
        var authState = await authStateTask;
        if (authState.User.Identity?.IsAuthenticated ?? false)
        {
            _petRocks = await _adoptionService.GetPetRocks();
        }

        _adoptableRocks = await _adoptionService.GetAdoptableRocks();
    }

}
